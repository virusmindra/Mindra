import json
import os
import copy
from stats import add_points, get_premium_until # добавь в начало goals.py
from pathlib import Path

GOALS_FILE = Path("user_goals.json")

    
# 🔑 Ключевые слова для определения "похоже на цель" на разных языках
goal_keywords_by_lang = {
    "ru": [
        "хочу", "планирую", "мечтаю", "цель", "начну", "запишусь", "начать",
        "буду делать", "постараюсь", "нужно", "пора", "начинаю", "собираюсь",
        "решил", "решила", "буду", "привычка", "добавить"
    ],
    "uk": [
        "хочу", "планую", "мрію", "ціль", "почну", "запишусь", "почати",
        "буду робити", "постараюся", "треба", "пора", "починаю", "збираюся",
        "вирішив", "вирішила", "буду", "звичка", "додати"
    ],
    "be": [
        "хачу", "планую", "мараю", "мэта", "пачну", "запішуся", "пачаць",
        "буду рабіць", "пастараюся", "трэба", "пара", "пачынаю", "збіраюся",
        "вырашыў", "вырашыла", "буду", "звычка", "дадаць"
    ],
    "kk": [
        "қалаймын", "жоспарлап отырмын", "арманым", "мақсат", "бастаймын", "жазыламын", "бастау",
        "істеймін", "тырысамын", "керек", "уақыты келді", "бастаймын", "жоспарлаймын",
        "шештім", "әдет", "қосу"
    ],
    "kg": [
        "каалайм", "пландоо", "күйүм", "максат", "баштайм", "жазылам", "баштоо",
        "кылам", "аракет кылам", "керек", "убагы келди", "баштайм", "чечтим",
        "адат", "кошуу"
    ],
    "hy": [
        "ուզում եմ", "նախատեսում եմ", "երազում եմ", "նպատակ", "սկսեմ", "գրանցվեմ", "սկսել",
        "պիտի անեմ", "կփորձեմ", "պետք է", "ժամանակն է", "սկսում եմ", "հավաքվում եմ",
        "որոշեցի", "սովորություն", "ավելացնել"
    ],
    "ce": [
        "декъаш", "план", "хьоьшам", "мацахь", "дахьа", "дӀалийтта", "кхеташ",
        "хийцам", "йаьлла", "керла", "хьажар", "йаьлча", "дӀаязде", "привычка"
    ],
    "md": [
        "vreau", "planific", "visez", "obiectiv", "încep", "mă înscriu", "să încep",
        "voi face", "mă voi strădui", "trebuie", "e timpul", "mă apuc", "mă pregătesc",
        "am decis", "obicei", "adaugă"
    ],
    "ka": [
        "მინდა", "ვგეგმავ", "ვოცნებობ", "მიზანი", "დავიწყებ", "ჩავეწერო", "დაწყება",
        "ვაპირებ", "ვეცდები", "საჭიროა", "დროა", "ვიწყებ", "ვსწყვეტ", "ჩვევის", "დამატება"
    ],
    "en": [
        "want", "plan", "dream", "goal", "start", "sign up", "begin",
        "will do", "try to", "need", "time to", "starting", "going to",
        "decided", "habit", "add"
    ],
    "fr": [
        "je veux", "je prévois", "rêve", "objectif", "commencer", "m'inscrire", "débuter",
        "je vais", "j'essaie", "besoin", "il est temps", "je commence", "je compte",
        "j'ai décidé", "habitude", "ajouter"
    ],
    "de": [
        "ich will", "ich plane", "träume", "ziel", "anfangen", "mich anmelden", "starten",
        "werde", "versuche", "muss", "es ist zeit", "ich beginne", "ich habe vor",
        "ich habe entschieden", "gewohnheit", "hinzufügen"
    ],
    "es": [
        "quiero", "planeo", "sueño", "meta", "empezar", "inscribirme", "comenzar",
        "voy a", "intentaré", "necesito", "es hora", "estoy empezando", "pienso",
        "he decidido", "hábito", "añadir"
    ],
    "pl": [
        "chcę", "planuję", "marzę", "cel", "zacznę", "zapiszę się", "zacząć",
        "będę", "spróbuję", "muszę", "czas", "zaczynam", "zamierzam",
        "zdecydowałem", "nawyk", "dodać"
    ],
}

def is_goal_like(text: str, lang: str = "ru") -> bool:
    keywords = goal_keywords_by_lang.get(lang, goal_keywords_by_lang["ru"])
    lower_text = text.lower()
    return any(kw in lower_text for kw in keywords)
    
REACTIONS_GOAL_DONE = {
    "ru": [
        "🌟 Горжусь тобой! Ещё один шаг вперёд.",
        "🥳 Отличная работа! Ты молодец.",
        "💪 Вот это настрой! Так держать.",
        "🔥 Ты сделал(а) это! Уважение 💜",
        "👏 Маленькие шаги — к большим победам.",
        "💜 Я горжусь твоей настойчивостью!",
        "✨ Так держать, всё получится!",
        "🚀 Вперёд к новым целям!",
        "🦋 Ты сам(а) — источник перемен.",
        "🎉 Цель достигнута, это круто!",
    ],
    "uk": [
        "🌟 Пишаюся тобою! Ще один крок вперед.",
        "🥳 Чудова робота! Ти молодець.",
        "💪 Ось це настрій! Так тримати.",
        "🔥 Ти це зробив(ла)! Респект 💜",
        "👏 Маленькі кроки — до великих перемог.",
        "💜 Я пишаюся твоєю наполегливістю!",
        "✨ Так тримати, все вийде!",
        "🚀 Вперед до нових цілей!",
        "🦋 Ти сам(а) — джерело змін.",
        "🎉 Мета досягнута, це круто!",
    ],
    "be": [
        "🌟 Ганаруся табой! Яшчэ адзін крок наперад.",
        "🥳 Цудоўная праца! Ты малайчына.",
        "💪 Вось гэта настрой! Так трымаць.",
        "🔥 Ты зрабіў(ла) гэта! Павага 💜",
        "👏 Маленькія крокі — да вялікіх перамог.",
        "💜 Я ганаруся тваёй настойлівасцю!",
        "✨ Так трымаць, усё атрымаецца!",
        "🚀 Наперад да новых мэтаў!",
        "🦋 Ты сам(а) — крыніца зменаў.",
        "🎉 Мэта дасягнута, гэта крута!",
    ],
    "kk": [
        "🌟 Сенмен мақтанамын! Тағы бір қадам алға.",
        "🥳 Жақсы жұмыс! Сен кереметсің.",
        "💪 Міне, осы нағыз көңіл-күй! Осылай жалғастыр.",
        "🔥 Сен мұны істедің! Құрмет 💜",
        "👏 Кішкентай қадамдар — үлкен жеңістерге.",
        "💜 Сенің табандылығыңмен мақтанамын!",
        "✨ Осылай жалғастыр, бәрі болады!",
        "🚀 Жаңа мақсаттарға алға!",
        "🦋 Өзгерістің бастауы — сен өзің.",
        "🎉 Мақсат орындалды, бұл керемет!",
    ],
    "kg": [
        "🌟 Сен менен сыймыктанам! Дагы бир кадам алдыга.",
        "🥳 Сонун иш! Молодец.",
        "💪 Мынакей күчтүү маанай! Ушундай улант.",
        "🔥 Сен муну жасадыӊ! Урмат 💜",
        "👏 Кичинекей кадамдар — чоң жеңиштерге.",
        "💜 Сенин тырышчаактыгыӊ менен сыймыктанам!",
        "✨ Ушундай уланта бер, баары болот!",
        "🚀 Жаңы максаттарга алга!",
        "🦋 Өзгөрүүнүн булагы — өзүң.",
        "🎉 Максат аткарылды, сонун!",
    ],
    "hy": [
        "🌟 Հպարտանում եմ քեզնով։ Եվս մեկ քայլ առաջ։",
        "🥳 Հիանալի աշխատանք։ Դու առարկայաբար լավն ես։",
        "💪 Ահա այսպիսի տրամադրություն։ Շարունակիր։",
        "🔥 Դու արեցիր դա։ Հարգանք 💜",
        "👏 Փոքր քայլերը մեծ հաղթանակների։",
        "💜 Հպարտ եմ քո համառությամբ։",
        "✨ Շարունակիր, ամեն ինչ կստացվի։",
        "🚀 Նոր նպատակների առաջ։",
        "🦋 Փոփոխությունների աղբյուրը դու ես։",
        "🎉 Նպատակն իրականացավ, դա հիանալի է։",
    ],
    "ce": [
        "🌟 Хьоьшу цуьнан! Ахкин а, кхетига къобал болу.",
        "🥳 Бахам хета! Хьо дика хьун.",
        "💪 Ву къобал хила! Кхетига.",
        "🔥 Хьо хийцам! Х1уш ву 💜",
        "👏 Керла хетам — цуьнан мотт.",
        "💜 Са цуьнан хьоьшу цуьнан!",
        "✨ Кхетига, цуьнан мотт болу!",
        "🚀 Кхетига хетам, кхетиг цуьнан!",
        "🦋 Хьо цуьнан хила, кхетиг буьйсан.",
        "🎉 Мацахьер цуьнан, ву бахам!",
    ],
    "md": [
        "🌟 Sunt mândru(ă) de tine! Încă un pas înainte.",
        "🥳 Super! Ai făcut o treabă grozavă.",
        "💪 Acesta e spiritul! Continuă așa.",
        "🔥 Ai reușit! Respect 💜",
        "👏 Pași mici spre mari victorii.",
        "💜 Sunt mândru(ă) de perseverența ta!",
        "✨ Continuă așa, vei reuși!",
        "🚀 Spre noi scopuri!",
        "🦋 Tu ești sursa schimbării.",
        "🎉 Ținta atinsă, e minunat!",
    ],
    "ka": [
        "🌟 შენით ვამაყობ! კიდევ ერთი ნაბიჯი წინ.",
        "🥳 შესანიშნავი საქმეა! ბრწყინვალედ გაართვი თავი.",
        "💪 ეს არის ნამდვილი განწყობა! ასე გააგრძელე.",
        "🔥 გააკეთე ეს! პატივისცემით 💜",
        "👏 პატარა ნაბიჯები — დიდ გამარჯვებებამდე.",
        "💜 ვამაყობ შენი მონდომებით!",
        "✨ ასე გააგრძელე, ყველაფერი გამოგივა!",
        "🚀 ახალი მიზნებისკენ წინ!",
        "🦋 ცვლილებების წყარო — შენ ხარ.",
        "🎉 მიზანი შესრულდა, ეს შესანიშნავია!",
    ],
    "en": [
        "🌟 I'm proud of you! Another step forward.",
        "🥳 Great job! You did amazing.",
        "💪 That's the spirit! Keep going.",
        "🔥 You did it! Respect 💜",
        "👏 Small steps lead to big victories.",
        "💜 I'm proud of your perseverance!",
        "✨ Keep it up, you’ll succeed!",
        "🚀 On to new goals!",
        "🦋 You are the source of change.",
        "🎉 Goal achieved, that’s awesome!",
    ]
}

DELETE_MESSAGES = {
    "ru": {
        "usage": "❌ Чтобы удалить цель, напиши так:\n`/delete 1`",
        "deleted": "🗑️ Цель удалена.",
        "not_found": "⚠️ Не могу найти такую цель."
    },
    "uk": {
        "usage": "❌ Щоб видалити ціль, напиши так:\n`/delete 1`",
        "deleted": "🗑️ Ціль видалена.",
        "not_found": "⚠️ Не можу знайти таку ціль."
    },
    "be": {
        "usage": "❌ Каб выдаліць мэту, напішы так:\n`/delete 1`",
        "deleted": "🗑️ Мэта выдалена.",
        "not_found": "⚠️ Не магу знайсці такую мэту."
    },
    "kk": {
        "usage": "❌ Мақсатты өшіру үшін осылай жазыңыз:\n`/delete 1`",
        "deleted": "🗑️ Мақсат өшірілді.",
        "not_found": "⚠️ Мұндай мақсат табылмады."
    },
    "kg": {
        "usage": "❌ Максатты өчүрүү үчүн мындай жазыңыз:\n`/delete 1`",
        "deleted": "🗑️ Максат өчүрүлдү.",
        "not_found": "⚠️ Мындай максат табылган жок."
    },
    "hy": {
        "usage": "❌ Նպատակը ջնջելու համար գրիր այսպես:\n`/delete 1`",
        "deleted": "🗑️ Նպատակը ջնջված է։",
        "not_found": "⚠️ Այդպիսի նպատակ չեմ կարող գտնել։"
    },
    "ce": {
        "usage": "❌ Мацахь кхоллар, так пишите:\n`/delete 1`",
        "deleted": "🗑️ Мацахь дӀелла.",
        "not_found": "⚠️ Цуьнан мацахь дукха ца дийцар."
    },
    "md": {
        "usage": "❌ Pentru a șterge un obiectiv, scrie:\n`/delete 1`",
        "deleted": "🗑️ Obiectivul a fost șters.",
        "not_found": "⚠️ Nu pot găsi un astfel de obiectiv."
    },
    "ka": {
        "usage": "❌ მიზნის წასაშლელად ასე დაწერე:\n`/delete 1`",
        "deleted": "🗑️ მიზანი წაშლილია.",
        "not_found": "⚠️ ვერ ვპოულობ ასეთ მიზანს."
    },
    "en": {
        "usage": "❌ To delete a goal, type:\n`/delete 1`",
        "deleted": "🗑️ Goal deleted.",
        "not_found": "⚠️ Can't find such a goal."
    },
}

NEW_LANG_ALIASES = {
    "fr": "en",
    "de": "en",
    "es": "en",
    "pl": "en",
}

for _alias, _base in NEW_LANG_ALIASES.items():
    for _name, _data in list(globals().items()):
        if _name in {"NEW_LANG_ALIASES"} or _name.startswith("__"):
            continue
        if isinstance(_data, dict) and _base in _data and _alias not in _data:
            _data[_alias] = copy.deepcopy(_data[_base])
